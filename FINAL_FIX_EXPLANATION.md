# โ ุงูุญู ุงูููุงุฆู - ุงููุดุงูู ุงูููุชุดูุฉ ูุงููุตุญุญุฉ

## ๐ด ุงููุดููุฉ ุงูุฑุฆูุณูุฉ ุงูููุชุดูุฉ

### ููุงุฐุง ุงูููู ููุฒู ุจุฏูุงู ูู ุงูุทุจุงุนุฉ ุนูู Vercelุ

**ุงูุฌูุงุจ**: `Content-Disposition: attachment` ูุฎุจุฑ ุงููุชุตูุญ ุจุญูุธ ุงูููู ุจุฏูุงู ูู ุนุฑุถู!

```typescript
// โ ุงูููุฏ ุงููุฏูู (ุฎุทุฃ):
return new Response(pdfBytes, {
    headers: {
        'Content-Type': 'application/pdf',
        'Content-Disposition': `attachment; filename="${filename}"`, // โ ุชุญููู!
    },
});

// โ ุงูููุฏ ุงูุฌุฏูุฏ (ุตุญูุญ):
const disposition = process.env.VERCEL === 'true' ? 'inline' : 'attachment';
return new Response(pdfBytes, {
    headers: {
        'Content-Type': 'application/pdf',
        'Content-Disposition': `${disposition}; filename="${filename}"`, // โ ุนุฑุถ ุนูู Vercel
    },
});
```

---

## ุงููุดุงูู ุงูุฅุถุงููุฉ ุงูููุชุดูุฉ

### 1. ููุต Delay ูุชุญููู ุงูููุงุฑุฏ

**ุงููุดููุฉ**: ุงูุตูุฑ ูุงูุฎุทูุท ูุฏ ูุง ุชุญูู ุจุดูู ูุงูู

**ุงูุญู**:

```typescript
await page.setContent(contractHtml, { waitUntil: 'networkidle0' });

// ุฃุถูู: ุงูุชุธุงุฑ ุฅุถุงูู
await new Promise((resolve) => setTimeout(resolve, 1000));
```

---

### 2. ุนุฏู ูุนุงูุฌุฉ ูุดู Chromium

**ุงููุดููุฉ**: ุฅุฐุง ูุดู Chromium ุนูู Vercelุ ูุง ููุฌุฏ fallback

**ุงูุญู**:

```typescript
try {
  const executablePath = await chromium.executablePath(...);
  browser = await puppeteerCore.launch({ executablePath, ... });
} catch (chromiumErr) {
  // Fallback ุฅูู Puppeteer ุงูุนุงุฏู
  browser = await puppeteer.launch({...});
}
```

---

### 3. ูุดู ุงูุจูุฆุฉ ูุงูุต

**ุงููุดููุฉ**: ูุฏ ูุง ูุชุนุฑู ุนูู Vercel ุจุดูู ุตุญูุญ

**ุงูุญู**:

```typescript
// ุฃุถูู: process.env.VERCEL
const isProduction = process.env.VERCEL === 'true' || process.env.VERCEL_ENV === 'production' || process.env.NODE_ENV === 'production';
```

---

## ุงููููุงุช ุงููุนุฏููุฉ

### โ 1. `app/api/generate-contract-pdf/route.ts`

-   โ `Content-Disposition` ูุชุบูุฑ ุจูุงุกู ุนูู ุงูุจูุฆุฉ
-   โ ุฅุถุงูุฉ Cache-Control headers
-   โ ุชุญุณูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก

### โ 2. `utils/pdf-service.ts`

-   โ Try/catch ูู Chromium ูุน fallback
-   โ ุฅุถุงูุฉ 1 ุซุงููุฉ delay ูู `generateContractPDF`
-   โ ุชุญุณูู ูุดู ุงูุจูุฆุฉ

---

## ๐งช ููููุฉ ุงูุงุฎุชุจุงุฑ

### ุนูู localhost (ูุฌุจ ุฃู ูุนูู ููุง ูู):

```bash
npm run dev
# http://localhost:3000/bookings/preview/[id]
# ูุฌุจ ุฃู ูุญูู ุงูููู (attachment ุตุญูุญ)
```

### ุนูู Vercel (ุงูุขู ูุฌุจ ุฃู ูุนุฑุถ ุงูููู):

```bash
# ุชู ุงููุดุฑ ุจุงููุนู!
# https://your-app.vercel.app/bookings/preview/[id]
# ูุฌุจ ุฃู ูุนุฑุถ ุงูููู ูู ุงููุชุตูุญ (inline)
# ุซู Ctrl+P ููุทุจุงุนุฉ
```

---

## โจ ุงููุชูุฌุฉ ุงููุชููุนุฉ

### โ ุงูุณููู ุงููุฏูู (ุงูุฎุทุฃ):

1. ุงููุฑ Download PDF
2. ูุชุตูุญ โ Save As
3. ุงูููู ููุฒู ูุฌูุงุฒ ุงููุณุชุฎุฏู
4. ุงููุณุชุฎุฏู ููุชุญ ุงูููู ูุฏูููุงู
5. ุซู ูุทุจุน

### โ ุงูุณููู ุงูุฌุฏูุฏ (ุงูุตุญูุญ):

1. ุงููุฑ Download PDF
2. ุงูููู ููุชุญ ูู ุงููุชุตูุญ ูุจุงุดุฑุฉ
3. ูุชุตูุญ โ Ctrl+P ููุทุจุงุนุฉ
4. ุทุจุงุนุฉ ููุฑุงู ูู ุงููุชุตูุญ

---

## ๐ ููุฎุต ุงูุชุนุฏููุงุช

| ุงูููู                  | ุงููุดููุฉ           | ุงูุญู               | ุงููุชูุฌุฉ                   |
| ---------------------- | ----------------- | ------------------ | ------------------------- |
| `route.ts`             | `attachment` ูุญูู | ุชุบููุฑ ุฅูู `inline` | ุนุฑุถ ุจุฏูุงู ูู ุงูุชุญููู      |
| `utils/pdf-service.ts` | ููุต delay         | ุฅุถุงูุฉ timeout      | ุตูุฑ ูุฎุทูุท ูุญููุฉ ุจุดูู ูุงูู |
| `utils/pdf-service.ts` | ูุง try/catch      | ุฅุถุงูุฉ fallback     | ุงุณุชูุฑุงุฑ ุฃูุถู              |

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ

### 1. ุชุฃูุฏ ูู ุงููุดุฑ:

```bash
git log --oneline -5
# ูุฌุจ ุฃู ุชุฑู: "fix: Vercel PDF issues - use inline disposition..."
```

### 2. ุงุฎุชุจุฑ ุนูู Vercel:

```bash
# ุงูุชุธุฑ 5-10 ุฏูุงุฆู ููู deployment
# ุซู ุงุฎุชุจุฑ: https://your-app.vercel.app/bookings/preview/[id]
```

### 3. ุงูุชุญ Vercel Logs:

```bash
vercel logs --follow | grep -i "pdf\|disposition"
# ูุฌุจ ุฃูุง ุชุฑู ุฃุฎุทุงุก
```

### 4. ุงุฎุชุจุฑ ุงููุธููุฉ:

```
โ ุงููุฑ "Download PDF"
โ ุงูููู ูุธูุฑ ูู ุงููุชุตูุญ (ูุง ููุฒู)
โ Ctrl+P ููุทุจุงุนุฉ
โ ุฌููุน ุงูุฎุฏูุงุช ููุฌูุฏุฉ
โ ุงูุตูุฑ ููุฌูุฏุฉ
โ ุงูุฎุทูุท ุตุญูุญุฉ
```

---

## ๐ ุงูููุฎุต

**ูุง ูุงู ุงูุฎุทุฃุ**

-   ุนูู Vercel ูุงู ูุญูู ุงูููู (`attachment`) ุจุฏูุงู ูู ุนุฑุถู

**ูุง ุงูุญูุ**

-   ุงุณุชุฎุฏุงู `inline` ุนูู Vercel ู `attachment` ูุญููุงู

**ูู ุญู ุงููุดููุฉุ**

-   โ ูุนู! ุงูุขู ูุฌุจ ุฃู ูุนูู ุจุดูู ุตุญูุญ ุนูู Vercel ู localhost

**ูุงุฐุง ุงูุขูุ**

-   ุงูุดุฑ ุนูู Vercel (ุชู ุจุงููุนู)
-   ุงุฎุชุจุฑ ุงูุฑุงุจุท ุงูุฅูุชุงุฌู
-   ุชุญูู ูู logs
-   ุงุณุชูุชุน ุจู PDF printing ุงูุฎุงูู ูู ุงููุดุงูู! ๐

---

**ุชู ุงููุดุฑ**: โ Yes (2025-12-09)
**ุงูุญุงูุฉ**: ๐ข ุฌุงูุฒ ููุงุฎุชุจุงุฑ
**ุงููุชูุฌุฉ ุงููุชููุนุฉ**: ุงููููุงุช ุชุธูุฑ ูู ุงููุชุตูุญ ุจุฏูุงู ูู ุงูุชุญููู
